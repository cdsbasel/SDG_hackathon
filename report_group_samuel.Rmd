---
title: "Unibas SDG Report"
description: null
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)

# read data
publications <- read_csv('0_data/publications_sdg.csv')
projects <- read_csv('0_data/projects_sdg.csv')

# count occurences
pub = publications %>% 
  select(starts_with("SDG") & ends_with("Elsevier")) %>% 
  colSums() %>% t() %>% 
  as_tibble() %>% 
  pivot_longer(everything()) %>% 
  mutate(item_type = "publication")

pro = projects %>% 
  select(starts_with("SDG") & ends_with("Elsevier")) %>% 
  colSums() %>% t() %>% 
  as_tibble() %>% 
  pivot_longer(everything()) %>% 
  mutate(item_type = "publication")

pro = projects %>% pivot_longer(45:59 )
pro2 <- pro %>% group_by(type,name, value) %>% tally() %>% filter(value == TRUE)

# for plot org-unit/sdg
publications_all <- publications %>%
  pivot_longer(starts_with("Org-"), names_to = "Organisations") %>%
  filter(value == TRUE) %>%
  group_by(Organisations) %>%
  select(`SDG-01-Elsevier`:`SDG-16-Elsevier`) %>%
  summarise_all(sum) 

publications_total <- publications_all %>%
  pivot_longer(`SDG-01-Elsevier`:`SDG-16-Elsevier`, names_to = "SDG") %>% 
  group_by(Organisations) %>%
  mutate(value = value/sum(value))


projects_test <- projects %>% 
  pivot_longer(starts_with("Org-"), names_to = "Organisations") %>% 
  filter(value == TRUE) %>% 
  group_by(Organisations) %>% 
  select(`SDG-01-Elsevier` : `SDG-16-Elsevier`) %>% 
  summarise_all(sum) %>% 
  ungroup() 

projects_test2 <- projects_test %>%   
  pivot_longer(`SDG-01-Elsevier` : `SDG-16-Elsevier`, names_to = "SDG") %>% 
  group_by(Organisations) %>% 
  mutate(value = value/sum(value))

```


# Introduction

Describe mission: Detect SDGs in research output of the University of Basel per request of Sustainability Office of Unibas.

<img src="https://upload.wikimedia.org/wikipedia/commons/d/df/Sustainable_Development_Goals.png"></img>

### Data

Research database & Grants office database

Three files correspinding to different research items: publications, projects (self funded), projects (externally funded)


### Methodological 

Limit to 2010 to 2020

Query search using Aurora (Link) and Elsevier (Link). Goldstandard? What are other Universities doing (Comparable)? Why are they different? Discuss caveats.
 
Conducted using corpustools R package and translations of the queries.

Choice of organizational unit

# Distribution of SDG

Text including numbers computed using inline code: No. articles, No. of projects, No. of matches (any SDG) in both. 

Text describing results in Figure. 

Figure showing frequency of SDG matches by SDG, output type (publication, self-funded project, externally-funded project)

```{r}
ggplot(data = pub) +
  geom_col(mapping = aes(x = name, y = value, fill = name)) +
  theme_minimal() +
  scale_fill_viridis_d() +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
  labs(
    title = "SDG Frequencies",
    subtitle = "Number of publications related to SDGs at University of Basel",
    x = "SDG",
    y = "Frequency"
  )
```

```{r}
ggplot(data = pro2, mapping = aes(x = name, y = n, fill = name, group = type, alpha = type)) +
  geom_bar(stat = "identity", position = "dodge", col = "white") +
  theme_minimal() +
  scale_fill_viridis_d() +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
  labs(
    title = "SDG Frequencies",
    subtitle = "Number of projects related to SDGs at University of Basel",
    x = "SDG",
    y = "Frequency"
  ) +
  scale_alpha_discrete( range = c(0.5, 1))
```



# Distribution of SDG across Time

Only meaningful Elsevir

# Distribution of SDG by organizational unit

Text describing organizational units incl. inline computed numbers. 

Text describing results in Figure. 

Figure showing frequency of SDGs by unit.
```{r}
ggplot(publications_total, aes(x= SDG, y=Organisations, fill = value)) +
  geom_tile() +
  theme_minimal() +
  scale_fill_viridis_c() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title.x = element_blank(),
    axis.title.y = element_blank()
  ) +
  labs(
    title = "Proportion of SDG Publications by Organisation"
  )
```

```{r}
ggplot(projects_test2, aes(x= SDG, y= Organisations, fill = value)) +
  geom_tile() +
  theme_minimal() +
  scale_fill_viridis_c() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title.x = element_blank(),
    axis.title.y = element_blank()
  ) +
  labs(
    title = "Proportion of SDG Projects by Organisation",
    x = "SDG",
    y = "Organisation"
  )
```


Interdisciplinarity (one unit versus multiple units?)


